\chapter{Sensitivity Analysis with StochSS}

%\section{\label{sec:pre}Prerequisites}
%\begin{itemize}
%\item StochSS 1.4 (or later) installed on your computer (please follow download and installation instructions at \url{www.stochss.org}). 
%\item A basic understanding of well-mixed discrete stochastic simulations and models based on ordinary differential equations \cite{dan,sundials}. 
%\item  A basic knowledge of the functionalities in the StochSS GUI (please consult the \textit{Basic Introduction to StochSS} tutorial).
%\item The following login screen appears on your browser; please log in.
%\end{itemize}
%
%\begin{figure}[!htb]
%\centering
%\includegraphics[scale=0.64]{T2/user-login.pdf}
%\end{figure}

StochSS implements forward sensitivity analysis for the deterministic (ODE-based) solver based on SUNDIAL's CVODES solver \cite{sundials}. The sensitivity analysis data generated by StochSS are unscaled (see explanation below).

\section{Example: Michaelis-Menten}

In this example we will study the Michaelis-Menten model from the StochSS Public Library. Details on the model can be found in \cite{wiki-michaelis-menten}.% and instructions on how to import it in Section~\ref{chapter1}. 
\begin{itemize}
\item Import the model from the public library. By default, it will be called \textit{michaelis\_menten}.
\item Navigate to the \textbf{Simulation Manager}, select the model, and click \textbf{Next}.
\item Under \textbf{Simulation type}, select \textit{Deterministic + Sensitivity}.
\item You can now select the parameters for which you wish to compute sensitivities. Select $Km$, $k3$, $mu$, and $Vmax$, as these are the only parameters that directly affect the values of the species $S$ and $P$.
\item Click \textbf{Run Locally}. 
\item Navigate to the \textbf{Job Summary} page to analyze the output. You can plot concentrations as well as sensitivities.
\end{itemize}

%Figure~\ref{fig:chapter3-sensi} shows a screenshot of the StochSS simulation page. We will perform a sensitivity analysis on the following parameters: \textit{mu, k3, Vmax}, and \textit{Km}. By looking at the reactions of the model (\textbf{Model Editor}$\to$\textbf{Reactions}) it is easy to see that these are the only parameters that directly affect the values of the species \textit{S} and \textit{P}. Also, note that the parameter \textit{k3} directly affects only the dynamics of species \textit{P}.

%We consider the Michaelis-Menten model that can be imported from the StochSS Public Library (see the \textit{Introduction to StochSS} tutorial for instructions on how to import models in StochSS). Details on the Michaelis-Menten model can be found at the following URL: \url{http://en.wikipedia.org/wiki/Michaelis-Menten_kinetics}%
%The snapshot below is from the StochSS simulation page. \textbf{\textit{mm}} is the unique name we assigned to the imported Michaelis-Menten model. We perform sensitivity analysis only on the relevant parameters of the model: \textit{mu, k3 Etot, Vmax} and \textit{Km}. On the \textcolor{blue}{Reactions} page of the  \textbf{\textit{mm}}  model it is easy to see that these are the only parameters that directly affect the values of the species \textit{S} and \textit{P}. Also, note on the same page that the parameter \textit{k3} directly affects only the dynamics of species \textit{P}.

%\begin{figure}[!htb]
%\centering
%\includegraphics[scale=0.64]{T2/sensi.pdf}
%\caption{\label{fig:chapter3-sensi}A screenshot of the simulation page.}
%\end{figure}

\subsection{Scaling in sensitivity analysis}
\label{sec:scaling_expl}
Let's consider the population of $P$ and the parameter $Vmax$ in our Michaelis-Menten model. The sensitivity of the rate of the increase in population $P$ to the parameter $Vmax$ is defined as the incremental rate of change in $P$ due to incremental changes in $Vmax$:

\begin{equation}
\frac{\partial P(t)}{\partial V_{max}}.
\end{equation}

The analysis of the relative importance of various parameters in determining the dynamic behavior of a population can be negatively affected by the presence of different scales in the parameter set. Hence, for the purpose of comparison, it is preferable to consider scaled sensitivities (also called elasticities). The elasticity for species $P$ with respect to parameter $Vmax$ is defined as:

\begin{equation}
\frac{\partial P(t)}{\partial V_{max}} \cdot \frac{V_{max}}{P(t)} = \frac{\partial \log(P(t))}{\partial\log(V_{max})}.
\end{equation}

Using elasticities for parameter comparison is an improvement over the use of unscaled sensitivities. However, it is worth remembering that the use of elasticity may lead to artifacts \cite{scale}. After all, elasticity is just one possible transformation that can be applied to the sensitivities. An interesting discussion about sensitivity transformations in ecology is given in \cite{scale}. \\
Among many possible transformation/scaling techniques, we would like to mention the dimensionless scaled sensitivity defined as \cite{calib}:

\begin{equation}
dss(t, V_{max}) = \frac{\partial P(t)}{\partial V_{max}} \cdot V_{max},
\end{equation}

and the \textbf{composite scaled sensitivity} defined as \cite{calib}:
\begin{equation}
css(t,V_{max}) = \sqrt \frac{\sum_{t=1}^N \left(dss(t,V_{max})\right)^2}{N},
\end{equation}
where $N$ is the number of observations.\\
Model simulation results will be more sensitive to parameters with larger \textit{elasticities}, \textit{css} and \textit{dss} values.\\
%The following simple \textit{octave/matlab} script uploads the data from a simulation run  \footnote{Please consult the \textit{Basic Introduction to StochSS} tutorial for instructions on how to download your simulation data.} (file \textit{output.txt}) of the Michaelis-Menten model, implements different scaling procedures and plots some of the results:
%
%\begin{verbatim}
%x = dlmread('output.txt'); % loading the data file
%t = x(5:size(x),1); % time array
%N = size(t,1); % number of observations
%St = x(5:size(x),2); % time series for S
%Pt = x(5:size(x),3); % time series for P
%% sensitivity analysis for S and P - Km, mu, Vmax, k3 
%sensiS = x(5:size(x),[4,6,8,10]); 
%sensiP = x(5:size(x),[5,7,9,11]);
%% parameters - Km, mu, Vmax, k3
%params = x(3,1:4); 
%% scaling correction to avoid division by zero
%deltaS = 0.0001 * (min(St(St(:, 1) > 0, 1))); 
%deltaP = 0.0001 * min(Pt(Pt(:, 1) > 0, 1));
%% dimensionless scaled sensitivity 
%%(weight is 1 for all observations)
%dssS = sensiS .* params; 
%elasticityS = dssS ./ (St .+ deltaS); 
%% composite scaled sensitivity
%cssS = sqrt(sum(dssS .* dssS) ./ N); 
%dssP = sensiP .* params;
%elasticityP = dssP ./ (St .+ deltaP); 
%cssP = sqrt(sum(dssP .* dssP) / N); 
%figure(1)
%plot(t,elasticityS)
%title ('Elasticities for S');
%xlabel('time');
%legend('Km','mu','Vmax','k3','location','northwest');
%figure(2)
%plot(t,elasticityP)
%title ('Elasticities for P');
%xlabel('time');
%legend('Km','mu','Vmax','k3','location','northeast');
%
%\end{verbatim}


